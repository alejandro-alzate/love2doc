<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from love2d.org/forums/viewtopic.php?p=259181 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 07 Apr 2024 17:24:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>2D Array - LÖVE</title>

	<link rel="alternate" type="application/atom+xml" title="Feed - LÖVE" href="app.php/feed">		<link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="app.php/feed/forums">	<link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="app.php/feed/topics">		<link rel="alternate" type="application/atom+xml" title="Feed - Forum - Support and Development" href="app.php/feed/forum/4">	<link rel="alternate" type="application/atom+xml" title="Feed - Topic - 2D Array" href="app.php/feed/topic/95650">	
	<link rel="canonical" href="viewtopic8f01.html?t=95650">

<!--
	phpBB style name: grouplove
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:      EntranceJew ( http://ejew.in/ )
-->

<link href="assets/css/font-awesome.min2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/normalize2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/base2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/utilities2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/common2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/links2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/content2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/buttons2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/cp2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/forms2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/icons2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/colours2257.css?assets_version=46" rel="stylesheet">
<link href="styles/prosilver/theme/responsive2257.css?assets_version=46" rel="stylesheet">

<link href="styles/grouplove/theme/stylesheet2257.css?assets_version=46" rel="stylesheet">

<link href="styles/prosilver/theme/en/stylesheet2257.css?assets_version=46" rel="stylesheet">
<link href="../favicon.png" rel="shortcut icon" type="image/png">



	<link href="assets/cookieconsent/cookieconsent.min2257.css?assets_version=46" rel="stylesheet">

<!--[if lte IE 9]>
	<link href="./styles/grouplove/theme/tweaks.css?assets_version=46" rel="stylesheet">
<![endif]-->



<link rel="stylesheet" href="../highlightjs/styles/docco.css"/>


</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">

<header id="love_header">
</header>


<div id="love_wrap">
		<nav>
		<a href="../index.html">Home</a>
		<a href="../wiki/Main_Page.html">Wiki</a>
		<a href="index.html">Forums</a>
		<a href="https://github.com/love2d/love/issues">Issue tracker</a>
		
						<div id="search-box" class="search-box search-header" role="search">
			<form action="https://love2d.org/forums/search.php" method="get" id="search">
			<fieldset>
				<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				
			</fieldset>
			</form>
		</div>
					</nav>
		
	<div id="love_content">
		<div id="wrap" class="wrap">
			<a id="top" class="top-anchor" accesskey="t"></a>
			<div id="page-header">
								<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
				
		
		<li class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">

			
							<span class="crumb" itemtype="https://schema.org/ListItem" itemprop="itemListElement" itemscope><a itemprop="item" href="index-2.html" accesskey="h" data-navbar-reference="index"><i class="icon fa-home fa-fw"></i><span itemprop="name">Board index</span></a><meta itemprop="position" content="1" /></span>

											
								<span class="crumb" itemtype="https://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="4"><a itemprop="item" href="viewforum31e6.html?f=4"><span itemprop="name">Support and Development</span></a><meta itemprop="position" content="2" /></span>
							
					</li>

		
					<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>
	
	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
													<li>
								<a href="memberlist.html" role="menuitem">
									<i class="icon fa-group fa-fw" aria-hidden="true"></i><span>Members</span>
								</a>
							</li>
																			<li>
								<a href="memberlist4bfd.html?mode=team" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucpa5ec.html?mode=login&amp;redirect=viewtopic.php%3Fp%3D259181" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp8319.html?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	</div>
</div>
			</div>

			
			<a id="start_here" class="anchor"></a>
			<div id="page-body" class="page-body" role="main">
				
				
<h2 class="topic-title"><a href="viewtopic8f01.html?t=95650">2D Array</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Questions about the LÖVE API, installing LÖVE and other support related questions go here.<br /></div>

	<div class="rules">
		<div class="inner">

					<strong>Forum rules</strong><br />
			Before you make a thread asking for help, <a href="viewtopica648.html?f=4&amp;t=2982" class="postlink">read this</a>.
		
		</div>
	</div>

<div class="action-bar bar-top">
	
			<a href="posting283f.html?mode=reply&amp;t=95650" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopicc544.html?t=95650&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://love2d.org/forums/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="95650" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			7 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
		</div>




			<div id="p259164" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile259164">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistc89a.html?mode=viewprofile&amp;u=258195" class="username">Bondrusiek</a>							</dt>

						<dd class="profile-rank">Prole</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search3ddd.html?author_id=258195&amp;sr=posts">13</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sun Dec 03, 2023 2:49 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content259164">

					<h3 class="first">
						<a href="viewtopicc4c4.html?p=259164#p259164">2D Array</a>
		</h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingbaa7.html?mode=quote&amp;p=259164" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicc4c4.html?p=259164#p259164" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistc89a.html?mode=viewprofile&amp;u=258195" class="username">Bondrusiek</a></strong> &raquo; </span><time datetime="2024-04-03T17:14:16+00:00">Wed Apr 03, 2024 5:14 pm</time>
			</p>
			
			
			
			<div class="content">Hi I have no a big experience with Lua. I have a problem with 2d array. I mark by "*" where is a critical points:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>FallingSand = Object:extend()

local WIDTH  = 500
local HEIGHT = 300
local m_size = 5
local m_cols
local m_rows
local m_grid = {}
local m_nextGrid = {}
local m_clicked = false
local m_hueValue = 0

function FallingSand:new()
    m_cols = math.floor(WIDTH / m_size)
    m_rows = math.floor(HEIGHT / m_size)
    for i = 1, m_cols do
        m_grid[i]     = {}
        m_nextGrid[i] = {}
        for j = 1, m_rows do 
            m_grid[i][j] = 0
            m_nextGrid[i][j] = 0
        end
    end
end

function FallingSand:update(dt)
    local mouseX, mouseY
    local mouseCol =  1
    local mouseRow = 1
    local matrix = 5
    local extent = math.floor(matrix / 2)
    if input:down('leftButton') then
        mouseX, mouseY = love.mouse.getPosition()
        mouseCol = math.floor(mouseX / m_size)
        mouseRow = math.floor(mouseY / m_size)
        for i = -extent, extent do
            for j = -extent, extent do
                local randomValue = love.math.random(100)
                if randomValue &lt; 75 then
                    local col = mouseCol + i + 1
                    local row = mouseRow + j + 1
                    if FallingSand:withinCols(col) and FallingSand:withinRows(row) then
                        --*********** here is m_grid[i][j] set to 100
                        m_grid[col][row] = 100 
                    end
                end

            end
        end

    for i = 1, m_cols do
        for j = 1, m_rows do 
            m_nextGrid[i][j] = 0
        end
    end

    for i = 1, m_cols do
        for j = 1, m_rows do
            --  What is the state?
            --*********** state always is set to 0 from m_grid[i][j]
            local state = m_grid[i][j]
            -- Randomly fall left or right
            if state &gt; 0 then 
                local below = m_grid[i][j + 1]
                -- Randomly fall left or right
                local dir = 1
                if love.math.random(100) &lt; 50 then 
                    dir = dir * -1
                end

                --Check below left or right
                local belowA = -1
                local belowB = -1
                if FallingSand:withinCols(i + dir) then 
                    belowA = m_grid[i + dir][j + 1]
                end
                if FallingSand:withinCols(i - dir) then 
                    belowB = m_grid[i - dir][j + 1]
                end
                -- Can it fall below or left or right?
                if below == 0 then 
                    m_nextGrid[i][j + 1] = state
                elseif belowA == 0 then 
                    m_nextGrid[i + dir][j + 1] = state
                elseif belowB == 0 then
                    m_nextGrid[i - dir][j + 1] = state;
                    -- Stay put!
                else 
                    m_nextGrid[i][j] = state;
                end
            end
        end
    end
    m_grid = m_nextGrid

    end
end

function FallingSand:draw()
    love.graphics.print("Falling Sand", 0, 0)
    for i = 1, m_cols do 
        for j = 1, m_rows do 
            if m_grid[i][j] &gt; 0 then 
                love.graphics.setColor(0.5, 1.0, 1.0)
                local x = (i - 1) * m_size
                local y = (j - 1) * m_size
                love.graphics.rectangle('fill', x, y, m_size, m_size)
            end
        end
    end
end

function FallingSand:withinCols(x)
    return x &gt;= 1 and x &lt;= m_cols
end

function FallingSand:withinRows(y)
    return y &gt;= 1 and y &lt;= m_rows
end

</code></pre></div>

I have no idea how solve that. I use print() func to debug value and in input:down() m_grid[][] is set on 100 but lower m_grid[] [] always return 0. Do you have nay tips ?</div>

			
			
									
						
										
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

				<div id="p259165" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile259165">
			<dt class="has-profile-rank has-avatar">
				<div class="avatar-container">
																<a href="memberlista9c1.html?mode=viewprofile&amp;u=210320" class="avatar"><img class="avatar" src="download/file3f90.png?avatar=210320_1676640211.png" width="90" height="90" alt="User avatar" /></a>														</div>
								<a href="memberlista9c1.html?mode=viewprofile&amp;u=210320" class="username">Bobble68</a>							</dt>

						<dd class="profile-rank">Party member</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search9429.html?author_id=210320&amp;sr=posts">159</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Nov 30, 2022 9:16 pm</dd>		
		
											
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact Bobble68">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact Bobble68</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://youtube.com/channel/httpsUCv5WbetlsBs1L8nlbugvNtg" title="YouTube" class="last-cell">
										<span class="contact-icon youtube_channel-icon">YouTube</span>									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content259165">

					<h3 >
						<a href="viewtopic1025.html?p=259165#p259165">Re: 2D Array</a>
		</h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4a1f.html?mode=quote&amp;p=259165" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic1025.html?p=259165#p259165" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista9c1.html?mode=viewprofile&amp;u=210320" class="username">Bobble68</a></strong> &raquo; </span><time datetime="2024-04-03T18:09:15+00:00">Wed Apr 03, 2024 6:09 pm</time>
			</p>
			
			
			
			<div class="content">Currently looking through it, however you haven't given us much to go on in terms of what's actually wrong vs what you want, so it's not easy to pinpoint the issue, especially without the full project.<br>
<br>
Edit: Something I have noticed is that at line 44 col and row can be 0 which isn't accounted for at line 51 which starts at 1, however I have no idea if this is intentional or is even related your problem.<br>
<br>
Edit 2: I've also noticed that you have a lot of variables with the m_ prefix, which I know is commonly used to show a variable is a member of a class. However (assuming my assuption is correct), this isn't how Lua works - the local variables here will be shared between all instances of the FallingSand object, which may be causing your problems (again, hard to know without context).<br>
<br>
In Lua, members of an object are accessed by indexing it, and object functions can access themselves by using the 'self' keyword. Here's what I imagine it should look like:<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>FallingSand = Object:extend()

local WIDTH  = 500
local HEIGHT = 300


function FallingSand:new()

    self.size = 5
    self.grid = {}
    self.nextGrid = {}
    self.clicked = false
    self.hueValue = 0
    self.cols = math.floor(WIDTH / self.size)
    self.rows = math.floor(HEIGHT / self.size)
    for i = 1, self.cols do
        self.grid[i]     = {}
        self.nextGrid[i] = {}
        for j = 1, self.rows do 
            self.grid[i][j] = 0
            self.nextGrid[i][j] = 0
        end
    end
end

function FallingSand:update(dt)
    local mouseX, mouseY
    local mouseCol =  1
    local mouseRow = 1
    local matrix = 5
    local extent = math.floor(matrix / 2)
    if input:down('leftButton') then
        mouseX, mouseY = love.mouse.getPosition()
        mouseCol = math.floor(mouseX / self.size)
        mouseRow = math.floor(mouseY / self.size)
        for i = -extent, extent do
            for j = -extent, extent do
                local randomValue = love.math.random(100)
                if randomValue &lt; 75 then
                    local col = mouseCol + i + 1
                    local row = mouseRow + j + 1
                    if FallingSand:withinCols(col) and FallingSand:withinRows(row) then
                        --*********** here is self.grid[i][j] set to 100
                        self.grid[col][row] = 100 
                    end
                end

            end
        end

        for i = 1, self.cols do
            for j = 1, self.rows do 
                self.nextGrid[i][j] = 0
            end
        end

        for i = 1, self.cols do
            for j = 1, self.rows do
                --  What is the state?
                --*********** state always is set to 0 from self.grid[i][j]
                local state = self.grid[i][j]
                -- Randomly fall left or right
                if state &gt; 0 then 
                    local below = self.grid[i][j + 1]
                    -- Randomly fall left or right
                    local dir = 1
                    if love.math.random(100) &lt; 50 then 
                        dir = dir * -1
                    end

                    --Check below left or right
                    local belowA = -1
                    local belowB = -1
                    if FallingSand:withinCols(i + dir) then 
                        belowA = self.grid[i + dir][j + 1]
                    end
                    if FallingSand:withinCols(i - dir) then 
                        belowB = self.grid[i - dir][j + 1]
                    end
                    -- Can it fall below or left or right?
                    if below == 0 then 
                        self.nextGrid[i][j + 1] = state
                    elseif belowA == 0 then 
                        self.nextGrid[i + dir][j + 1] = state
                    elseif belowB == 0 then
                        self.nextGrid[i - dir][j + 1] = state;
                        -- Stay put!
                    else 
                        self.nextGrid[i][j] = state;
                    end
                end
            end
        end
    self.grid = self.nextGrid

    end
end

function FallingSand:draw()
    love.graphics.print("Falling Sand", 0, 0)
    for i = 1, self.cols do 
        for j = 1, self.rows do 
            if self.grid[i][j] &gt; 0 then 
                love.graphics.setColor(0.5, 1.0, 1.0)
                local x = (i - 1) * self.size
                local y = (j - 1) * self.size
                love.graphics.rectangle('fill', x, y, self.size, self.size)
            end
        end
    end
end

function FallingSand:withinCols(x)
    return x &gt;= 1 and x &lt;= self.cols
end

function FallingSand:withinRows(y)
    return y &gt;= 1 and y &lt;= self.rows
end

</code></pre></div>

The variable declarations have been moved inside the :new() function, since they need to be declared for every new object. Hopefully this is your issue, but it's impossible to say.</div>

			
			
													<div class="notice">
					Last edited by <a href="memberlista9c1.html?mode=viewprofile&amp;u=210320" class="username">Bobble68</a> on Wed Apr 03, 2024 6:28 pm, edited 2 times in total.
									</div>
			
						
							<div id="sig259165" class="signature">Dragon</div>			
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

				<div id="p259166" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile259166">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist9cd8.html?mode=viewprofile&amp;u=138465" class="username">MrFariator</a>							</dt>

						<dd class="profile-rank">Party member</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search3721.html?author_id=138465&amp;sr=posts">510</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Oct 05, 2016 11:53 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content259166">

					<h3 >
						<a href="viewtopic00ed.html?p=259166#p259166">Re: 2D Array</a>
		</h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingd3dc.html?mode=quote&amp;p=259166" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic00ed.html?p=259166#p259166" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist9cd8.html?mode=viewprofile&amp;u=138465" class="username">MrFariator</a></strong> &raquo; </span><time datetime="2024-04-03T18:16:23+00:00">Wed Apr 03, 2024 6:16 pm</time>
			</p>
			
			
			
			<div class="content">Keep in mind that whenever you create a new instance of this FallingSand class, the m_grid variable is essentially reset (ie. the "state" becomes 0 for all entries). You might be creating new instances somewhere else in your code, and this is the source of your woes.<br>
<br>
To fix this, you'd need to make sure that each instance of this FallingSand class would have its own m_grid variable. For example, inside the new function you'd do this:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>function FallingSand:new()
    m_cols = math.floor(WIDTH / m_size)
    m_rows = math.floor(HEIGHT / m_size)
    
    -- 'self' refers to the new instance we're creating
    self.m_grid = {}
    for i = 1, m_cols do
        self.m_grid[i] = {}
        for j = 1, m_rows do 
            self.m_grid[i][j] = 0
        end
    end
end</code></pre></div>

And similarly handle the "m_grid" in other places via the "self". Of course, this is assuming you are using <a href="https://github.com/rxi/classic/" class="postlink">classic</a>.</div>

			
			
									
						
										
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

				<div id="p259173" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile259173">
			<dt class="has-profile-rank has-avatar">
				<div class="avatar-container">
																<a href="memberlist99fb.html?mode=viewprofile&amp;u=137168" class="avatar"><img class="avatar" src="download/file0cce.png?avatar=137168_1466472518.png" width="90" height="90" alt="User avatar" /></a>														</div>
								<a href="memberlist99fb.html?mode=viewprofile&amp;u=137168" class="username">pgimeno</a>							</dt>

						<dd class="profile-rank">Party member</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchc6e5.html?author_id=137168&amp;sr=posts">3547</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sun Oct 18, 2015 2:58 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content259173">

					<h3 >
						<a href="viewtopicfea1.html?p=259173#p259173">Re: 2D Array</a>
		</h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting918d.html?mode=quote&amp;p=259173" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicfea1.html?p=259173#p259173" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist99fb.html?mode=viewprofile&amp;u=137168" class="username">pgimeno</a></strong> &raquo; </span><time datetime="2024-04-04T11:01:26+00:00">Thu Apr 04, 2024 11:01 am</time>
			</p>
			
			
			
			<div class="content">There's also an indentation problem within FallingSand:update(). This IF statement:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>if input:down('leftButton') then
</code></pre></div>
is closed at the very end of the function, but the indentation suggests that that's not the intention.</div>

			
			
									
						
							<div id="sig259173" class="signature"><a href="viewtopic187f.html?t=81198" class="postlink">Thrust II Reloaded</a> - <a href="viewtopic0012.html?t=82642" class="postlink">GifLoad for Löve</a> - <a href="https://notabug.org/pgimeno/Gspot" class="postlink">GSpöt GUI</a> - <a href="https://notabug.org/pgimeno" class="postlink">My NotABug.org repositories</a></div>			
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

				<div id="p259174" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile259174">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistc89a.html?mode=viewprofile&amp;u=258195" class="username">Bondrusiek</a>							</dt>

						<dd class="profile-rank">Prole</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search3ddd.html?author_id=258195&amp;sr=posts">13</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sun Dec 03, 2023 2:49 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content259174">

					<h3 >
						<a href="viewtopic1edc.html?p=259174#p259174">Re: 2D Array</a>
		</h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4036.html?mode=quote&amp;p=259174" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic1edc.html?p=259174#p259174" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistc89a.html?mode=viewprofile&amp;u=258195" class="username">Bondrusiek</a></strong> &raquo; </span><time datetime="2024-04-04T17:14:20+00:00">Thu Apr 04, 2024 5:14 pm</time>
			</p>
			
			
			
			<div class="content">pgimeno MrFariator Boble68 thank you for your suggestion/tips/help! <br>
<br>
I also investigate a bit and I found the interesting thing. I would like to point out that I am not an expert in Lua (I am more C++-centric):<br>
I printed two values one is self.grid and second is self.nextGrid:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>    print("grid ", self.grid)
    print("next_grid ", self.nextGrid)</code></pre></div>
<blockquote class="uncited"><div>
grid 	table: 0x01033e9970<br>
next_grid 	table: 0x01033e99b8
</div></blockquote>
If I understand correctly on the right is an address of memory so If I assign 
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>self.grid = self.nextGrid</code></pre></div>
<em class="text-italics">self.grid</em> is the same memory address like <em class="text-italics">self.nextGrid</em>. I have to assign only values so I created a for loop:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>        for i = 1, self.cols do
            for j = 1, self.rows do
                if self.grid[i][j] ~= self.nextGrid[i][j] then
                    self.grid[i][j] = self.nextGrid[i][j]
                end
            end
        end</code></pre></div>
I create a falling sand effect. Here is my Love2D example.
<div class="inline-attachment">
			
		
				<dl class="file">
			<dt class="attach-image"><a href="download/filea04f.png?id=24125&amp;mode=view"><img src="download/file4583.png?id=24125" class="postimage" alt="test.png" /></a></dt>
						<dd>test.png (19.8 KiB) Viewed 160 times</dd>
		</dl>
		
		
			</div>

PS.<br>
I have a problem with <strong class="text-strong"><em class="text-italics">classic</em></strong> module. IE
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>FallingSand = Object:extend()

function FallingSand:new()
    self.cols = 5
end

function FallingSand:update(dt)
	print(FallingSand:withinCols(5))
end

function FallingSand:draw()

end

function FallingSand:withinCols(x)
    return x &gt;= 1 and x &lt;= self.cols -- Other func than new/update/draw. In this kind of function all self values are nil ???
end
</code></pre></div></div>

			
			
									
						
										
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

				<div id="p259176" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile259176">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistd5c7.html?mode=viewprofile&amp;u=155226" class="username">RNavega</a>							</dt>

						<dd class="profile-rank">Party member</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search63c7.html?author_id=155226&amp;sr=posts">244</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sun Aug 16, 2020 1:28 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content259176">

					<h3 >
						<a href="viewtopica9a4.html?p=259176#p259176">Re: 2D Array</a>
		</h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingd6e4.html?mode=quote&amp;p=259176" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopica9a4.html?p=259176#p259176" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistd5c7.html?mode=viewprofile&amp;u=155226" class="username">RNavega</a></strong> &raquo; </span><time datetime="2024-04-04T21:12:39+00:00">Thu Apr 04, 2024 9:12 pm</time>
			</p>
			
			
			
			<div class="content"><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>function FallingSand:update(dt)
	print(FallingSand:withinCols(5))
end</code></pre></div>
Try self:withinCols(5) so the sugar becomes FallingSand.withinCols(self, 5).<br>
<br>
The colon syntax is explained in here (the entire PIL e-book is useful btw): <a href="https://www.lua.org/pil/16.html" class="postlink">https://www.lua.org/pil/16.html</a></div>

			
			
									
						
										
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

				<div id="p259181" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile259181">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistc89a.html?mode=viewprofile&amp;u=258195" class="username">Bondrusiek</a>							</dt>

						<dd class="profile-rank">Prole</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search3ddd.html?author_id=258195&amp;sr=posts">13</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sun Dec 03, 2023 2:49 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content259181">

					<h3 >
						<a href="viewtopicd35d.html?p=259181#p259181">Re: 2D Array</a>
		</h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinge4dd.html?mode=quote&amp;p=259181" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicd35d.html?p=259181#p259181" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistc89a.html?mode=viewprofile&amp;u=258195" class="username">Bondrusiek</a></strong> &raquo; </span><time datetime="2024-04-05T14:17:13+00:00">Fri Apr 05, 2024 2:17 pm</time>
			</p>
			
			
			
			<div class="content"><blockquote class="uncited"><div>Try self:withinCols(5) so the sugar becomes FallingSand.withinCols(self, 5).</div></blockquote>

It works now. Thank you!</div>

			
			
									
						
										
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	

	<div class="action-bar bar-bottom">
	
			<a href="posting283f.html?mode=reply&amp;t=95650" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopicc544.html?t=95650&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://love2d.org/forums/viewtopic.php?t=95650">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			7 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum31e6.html?f=4" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “Support and Development”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum4d6b.html?f=3" class="jumpbox-forum-link"> <span> General</span></a></li>
																<li><a href="viewforum31e6.html?f=4" class="jumpbox-forum-link"> <span> Support and Development</span></a></li>
																<li><a href="viewforum9780.html?f=14" class="jumpbox-forum-link"> <span> Games and Creations</span></a></li>
																<li><a href="viewforume774.html?f=5" class="jumpbox-forum-link"> <span> Libraries and Tools</span></a></li>
																<li><a href="viewforumd42b.html?f=7" class="jumpbox-cat-link"> <span> Community</span></a></li>
																<li><a href="viewforum01c9.html?f=12" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Ports</span></a></li>
																<li><a href="viewforum15ca.html?f=10" class="jumpbox-sub-link"><span class="spacer"></span><span class="spacer"></span> <span>&#8627; &nbsp; nLÖVE</span></a></li>
																<li><a href="viewforum8a83.html?f=11" class="jumpbox-sub-link"><span class="spacer"></span><span class="spacer"></span> <span>&#8627; &nbsp; LÖVE-Android</span></a></li>
																<li><a href="viewforumeb13.html?f=13" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Archives</span></a></li>
																<li><a href="viewforum957d.html?f=8" class="jumpbox-sub-link"><span class="spacer"></span><span class="spacer"></span> <span>&#8627; &nbsp; A Whiff of Steam</span></a></li>
											</ul>
		</div>
	</div>

	</div>


	<div class="stat-block online-list">
		<h3><a href="viewonline.html">Who is online</a></h3>
		<p>Users browsing this forum: No registered users and 4 guests</p>
	</div>

							</div>

		
		<div id="page-footer" class="page-footer" role="contentinfo">
			<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
									<span class="crumb"><a href="index-2.html" data-navbar-reference="index"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC">UTC</span></li>
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete cookies</span>
				</a>
			</li>
							<li class="rightside" data-last-responsive="true">
					<a href="memberlist.html" title="View complete list of members" role="menuitem">
						<i class="icon fa-group fa-fw" aria-hidden="true"></i><span>Members</span>
					</a>
				</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist4bfd.html?mode=team" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist8733.html?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

			<div class="copyright">
								Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
																			</div>

			<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
				<div id="darken" class="darken">&nbsp;</div>
			</div>

			<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
				<a href="#" class="alert_close">
					<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
				</a>
				<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
			</div>
			<div id="phpbb_confirm" class="phpbb_alert">
				<a href="#" class="alert_close">
					<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
				</a>
				<div class="alert_text"></div>
			</div>
		</div>

		<div>
			<a id="bottom" class="anchor" accesskey="z"></a>
					</div>

		</div>
	</div> <!-- love_content -->
</div> <!-- love_wrap -->

<script type="text/javascript" src="assets/javascript/jquery-3.6.0.min2257.js?assets_version=46"></script>
<script type="text/javascript" src="assets/javascript/core2257.js?assets_version=46"></script>

	<script src="assets/cookieconsent/cookieconsent.min2257.js?assets_version=46"></script>
	<script>
		window.addEventListener("load", function(){
			window.cookieconsent.initialise({
				"palette": {
					"popup": {
						"background": "#0F538A"
					},
					"button": {
						"background": "#E5E5E5"
					}
				},
				"theme": "classic",
				"content": {
					"message": "This\u0020website\u0020uses\u0020cookies\u0020to\u0020ensure\u0020you\u0020get\u0020the\u0020best\u0020experience\u0020on\u0020our\u0020website.",
					"dismiss": "Got\u0020it\u0021",
					"link": "Learn\u0020more"
				}
			})});
	</script>

<script type="text/javascript" src="../MathJax/MathJax.js">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["\\(","\\)"]]}
  });
</script>

<script type="text/javascript" src="../highlightjs/highlight.pack.js"></script>
<script type="text/javascript">
hljs.configure();
function hljs_init() {
	var elements = document.getElementsByTagName("code");
	for (var i = 0; i < elements.length; i++) {
		hljs.highlightBlock(elements[i]);
	}
};
$(document).ready(hljs_init);
</script>

<script>
(function($) {  // Avoid conflicts with other libraries

'use strict';

	phpbb.addAjaxCallback('reporttosfs', function(data) {
		if (data.postid !== "undefined") {
			$('#sfs' + data.postid).hide();
			phpbb.closeDarkenWrapper(5000);
		}
	});

})(jQuery);
</script>
<script src="styles/prosilver/template/forum_fn2257.js?assets_version=46"></script>
<script src="styles/prosilver/template/ajax2257.js?assets_version=46"></script>

<script src="../egg.js"></script>


</body>

<!-- Mirrored from love2d.org/forums/viewtopic.php?p=259181 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 07 Apr 2024 17:24:58 GMT -->
</html>
